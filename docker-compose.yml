services:
  sequencer:
    build:
      context: ./
    image: "ghcr.io/vocdoni/davinci-node:${DAVINCI_NODE_TAG:-main}"
    env_file: .env
    environment:
      - DAVINCI_DATADIR=/app/run
      - SEQUENCER_API_URL=${SEQUENCER_API_URL:-http://localhost:9090}
      - BLOCK_EXPLORER_URL=${BLOCK_EXPLORER_URL:-https://sepolia.etherscan.io/address}
    volumes:
      - run:/app/run
    ports:
      - "${DAVINCI_API_PORT:-9090}:9090"                     # REST API gateway and Web UI
    sysctls:
      net.core.somaxconn: 8128
    restart: ${RESTART:-unless-stopped}

  watchtower:
    image: containrrr/watchtower
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    labels:
      - com.centurylinklabs.watchtower.enable="false"
    command: --interval 30 --include-stopped --revive-stopped
    restart: ${RESTART:-unless-stopped}

volumes:
  run: {}
